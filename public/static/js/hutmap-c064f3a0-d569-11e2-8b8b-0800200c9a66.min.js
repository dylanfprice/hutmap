/*
 MIT License, http://www.opensource.org/licenses/MIT
*/
'use strict';(function(){angular.module("AngularGM",[]).value("angulargmDefaults",{mapOptions:{zoom:8,center:new google.maps.LatLng(46,-120),mapTypeId:google.maps.MapTypeId.ROADMAP}})})();
(function(){angular.module("AngularGM").directive("gmMap",["$timeout",function(a){return{restrict:"AE",priority:100,template:'<div><div id="" style="width:100%;height:100%;"></div><div ng-transclude></div></div>',transclude:!0,replace:!0,scope:{gmCenter:"=",gmZoom:"=",gmBounds:"=",gmMapOptions:"&",gmMapId:"&"},controller:"angulargmMapController",link:function(b,c,d,e){if(angular.isDefined(b.gmCenter)||(b.center={}),angular.isDefined(b.gmBounds)||(b.bounds={}),!angular.isDefined(b.gmMapId))throw"angulargm must have non-empty gmMapId attribute";
var g=!1,h=!1,f=!1;d.hasOwnProperty("gmCenter")&&(g=!0);d.hasOwnProperty("gmZoom")&&(h=!0);d.hasOwnProperty("gmBounds")&&(f=!0);c=function(){a(function(){(g||h||f)&&b.$apply(function(){if(g&&(b.gmCenter=e.center),h&&(b.gmZoom=e.zoom),f){var a=e.bounds;a&&(b.gmBounds=a)}})})};e.addMapListener("drag",c);e.addMapListener("zoom_changed",c);e.addMapListener("center_changed",c);e.addMapListener("bounds_changed",c);g&&b.$watch("gmCenter",function(a,b){a!==b&&!e.dragging&&a&&(e.center=a)},!0);h&&b.$watch("gmZoom",
function(a,b){null!=a&&!isNaN(a)&&a!==b&&(e.zoom=a)});f&&b.$watch("gmBounds",function(a,b){a!==b&&!e.dragging&&a&&(e.bounds=a)})}}}])})();
(function(){angular.module("AngularGM").directive("gmMarkers",["$log","$parse","$timeout","angulargmUtils",function(a,b,c,d){d.latLngEqual;var e=d.objToLatLng;return{restrict:"AE",priority:100,scope:{gmObjects:"&",gmGetLatLng:"&",gmGetMarkerOptions:"&",gmEvent:"&"},require:"^gmMap",link:function(a,d,f,j){if(!("gmObjects"in f))throw"gmObjects attribute required";if(!("gmGetLatLng"in f))throw"gmGetLatLng attribute required";var m={};angular.forEach(f,function(a,k){if(0===k.lastIndexOf("gmOn",0)){var j=
angular.lowercase(k.substring(4)),d=b(a);m[j]=d}});var k=function(b){var k={};angular.forEach(b,function(b){var d=a.gmGetLatLng({object:b}),q=e(d);if(null!=q){var p=a.gmGetMarkerOptions({object:b}),f=q.toUrlValue(j.precision);if(k[f]=b,!j.hasMarker(d.lat,d.lng)){f={};angular.extend(f,p,{position:q});j.addMarker(f);var h=j.getMarker(d.lat,d.lng);angular.forEach(m,function(k,d){j.addListener(h,d,function(){c(function(){k(a.$parent.$parent,{object:b,marker:h})})})})}}});var d=[];j.forEachMarker(function(a){a.getPosition().toUrlValue(j.precision)in
k||d.push(a)});angular.forEach(d,function(a){a=a.getPosition();j.removeMarker(a.lat(),a.lng())})};a.$watch("gmObjects().length",function(b,j){null!=b&&b!==j&&k(a.gmObjects())});a.$watch("gmObjects()",function(b,j){null!=b&&b!==j&&k(a.gmObjects())});a.$watch("gmEvent()",function(a,b){if(null!=a&&a!==b){var k=a.event,d=a.location,d=j.getMarker(d.lat(),d.lng());null!=d&&c(angular.bind(this,j.trigger,d,k))}});c(angular.bind(null,k,a.gmObjects()))}}}])})();
(function(){angular.module("AngularGM").factory("angulargmContainer",["$q",function(a){var b={},c={};return{addMap:function(a,e){if(!(e instanceof google.maps.Map))throw"map not a google.maps.Map: "+e;if(a in b)throw"already contain map with id "+a;b[a]=e;a in c&&c[a].resolve(e)},getMap:function(a){return b[a]},getMapPromise:function(b){var e=c[b]||a.defer();return c[b]=e,e.promise},removeMap:function(a){a in b&&delete b[a];a in c&&delete c[a]},clear:function(){b={};c={}}}}])})();
(function(){angular.module("AngularGM").factory("angulargmUtils",[function(){function a(a,c){var d;if(a instanceof google.maps.LatLng&&c instanceof google.maps.LatLng){d=a.lat();var e=c.lat();if(d=1E-6>Math.abs(d-e))d=a.lng(),e=c.lng(),d=1E-6>Math.abs(d-e)}else d=!1;return d}return{latLngEqual:a,boundsEqual:function(b,c){if(!(b instanceof google.maps.LatLngBounds&&c instanceof google.maps.LatLngBounds))return!1;var d=b.getSouthWest(),e=c.getSouthWest(),g=b.getNorthEast(),h=c.getNorthEast();return a(d,
e)&&a(g,h)},latLngToObj:function(a){if(!(a instanceof google.maps.LatLng))throw"latLng not a google.maps.LatLng";return{lat:a.lat(),lng:a.lng()}},objToLatLng:function(a){if(null!=a){var c=a.lat;a=a.lng;if(!(null==c||null==a||isNaN(c)||isNaN(a)))return new google.maps.LatLng(c,a)}return null},hasNaN:function(a){if(!(a instanceof google.maps.LatLng))throw"latLng must be a google.maps.LatLng";var c=null==a.lat()||null==a.lng();a=isNaN(a.lat())||isNaN(a.lng());return c||a}}}])})();
(function(){angular.module("AngularGM").controller("angulargmMapController",["$scope","$element","angulargmUtils","angulargmDefaults","angulargmContainer",function(a,b,c,d,e){var g=c.latLngEqual,h=c.boundsEqual,f=c.hasNaN;this._getConfig=function(a,b){var k={};return angular.extend(k,b.mapOptions,a.gmMapOptions()),k};this._createMap=function(a,b,k,d){var c=d.getMap(a);if(c)throw"A map with id "+a+" already exists. You must use different ids for each instance of the angulargm directive.";return c=
new google.maps.Map(b[0],k),d.addMap(a,c),c};this._initDragListeners=function(){var a=this;this.addMapListener("dragstart",function(){a.dragging=!0});this.addMapListener("idle",function(){a.dragging=!1});this.addMapListener("drag",function(){a.dragging=!0})};this._destroy=function(a){e.removeMap(a)};this.addMapListener=function(a,b){google.maps.event.addListener(this._map,a,b)};this.addMapListenerOnce=function(a,b){google.maps.event.addListenerOnce(this._map,a,b)};this.addListener=function(a,b,k){google.maps.event.addListener(a,
b,k)};this.addListenerOnce=function(a,b,k){google.maps.event.addListenerOnce(a,b,k)};this.mapTrigger=function(a){google.maps.event.trigger(this._map,a)};this.trigger=function(a,b){google.maps.event.trigger(a,b)};this.addMarker=function(a){var b={};if(angular.extend(b,a),!(b.position instanceof google.maps.LatLng))throw"markerOptions did not contain a position";a=new google.maps.Marker(b);b=a.getPosition();if(this.hasMarker(b.lat(),b.lng()))return!1;b=b.toUrlValue(this.precision);return this._markers[b]=
a,a.setMap(this._map),!0};this.hasMarker=function(a,b){return this.getMarker(a,b)instanceof google.maps.Marker};this.getMarker=function(a,b){if(null==a||null==b)throw"lat or lng was null";var k=(new google.maps.LatLng(a,b)).toUrlValue(this.precision);return k in this._markers?this._markers[k]:null};this.removeMarker=function(a,b){if(null==a||null==b)throw"lat or lng was null";var k=!1,d=(new google.maps.LatLng(a,b)).toUrlValue(this.precision),c=this._markers[d];return c&&(c.setMap(null),k=!0),this._markers[d]=
null,delete this._markers[d],k};this.fitToMarkers=function(){var a=new google.maps.LatLngBounds;this.forEachMarker(function(b){a.extend(b.getPosition())});this.bounds=a};this.forEachMarker=function(a){if(null==a)throw"fn was null or undefined";angular.forEach(this._markers,function(b){null!=b&&a(b)})};angular.bind(this,function(a,b){var k=a.gmMapId();if(!k)throw"angulargm must have non-empty gmMapId attribute";var c=b.find("[id]");c.attr("id",k);var n=this._getConfig(a,d);this._map=this._createMap(k,
c,n,e);this._markers={};this.dragging=!1;Object.defineProperties(this,{precision:{value:3,writeable:!1},center:{configurable:!0,get:function(){return this._map.getCenter()},set:function(a){if(f(a))throw"center contains null or NaN";!g(this.center,a)&&this._map.panTo(a)}},zoom:{configurable:!0,get:function(){return this._map.getZoom()},set:function(a){if(null==a||isNaN(a))throw"zoom was null or NaN";this.zoom!==a&&this._map.setZoom(a)}},bounds:{configurable:!0,get:function(){return this._map.getBounds()},
set:function(a){if(f(a.getSouthWest())||f(a.getNorthEast()))throw"bounds contains null or NaN";!h(this.bounds,a)&&this._map.fitBounds(a)}}});this._initDragListeners();a.$on("$destroy",angular.bind(this,this._destroy,k))})(a,b)}])})();/*
 MIT License, http://www.opensource.org/licenses/MIT
*/
(function(){angular.module("AngularGM",[]).value("angulargmDefaults",{mapOptions:{zoom:8,center:new google.maps.LatLng(46,-120),mapTypeId:google.maps.MapTypeId.ROADMAP}})})();
(function(){angular.module("AngularGM").directive("gmMap",["$timeout",function(a){return{restrict:"AE",priority:100,template:'<div><div id="" style="width:100%;height:100%;"></div><div ng-transclude></div></div>',transclude:!0,replace:!0,scope:{gmCenter:"=",gmZoom:"=",gmBounds:"=",gmMapOptions:"&",gmMapId:"&"},controller:"angulargmMapController",link:function(b,c,d,e){if(angular.isDefined(b.gmCenter)||(b.center={}),angular.isDefined(b.gmBounds)||(b.bounds={}),!angular.isDefined(b.gmMapId))throw"angulargm must have non-empty gmMapId attribute";
var g=!1,h=!1,f=!1;d.hasOwnProperty("gmCenter")&&(g=!0);d.hasOwnProperty("gmZoom")&&(h=!0);d.hasOwnProperty("gmBounds")&&(f=!0);c=function(){a(function(){(g||h||f)&&b.$apply(function(){if(g&&(b.gmCenter=e.center),h&&(b.gmZoom=e.zoom),f){var a=e.bounds;a&&(b.gmBounds=a)}})})};e.addMapListener("drag",c);e.addMapListener("zoom_changed",c);e.addMapListener("center_changed",c);e.addMapListener("bounds_changed",c);g&&b.$watch("gmCenter",function(a,b){a!==b&&!e.dragging&&a&&(e.center=a)},!0);h&&b.$watch("gmZoom",
function(a,b){null!=a&&!isNaN(a)&&a!==b&&(e.zoom=a)});f&&b.$watch("gmBounds",function(a,b){a!==b&&!e.dragging&&a&&(e.bounds=a)})}}}])})();
(function(){angular.module("AngularGM").directive("gmMarkers",["$log","$parse","$timeout","angulargmUtils",function(a,b,c,d){d.latLngEqual;var e=d.objToLatLng;return{restrict:"AE",priority:100,scope:{gmObjects:"&",gmGetLatLng:"&",gmGetMarkerOptions:"&",gmEvents:"&"},require:"^gmMap",link:function(a,d,f,j){if(!("gmObjects"in f))throw"gmObjects attribute required";if(!("gmGetLatLng"in f))throw"gmGetLatLng attribute required";var m={};angular.forEach(f,function(a,k){if(0===k.lastIndexOf("gmOn",0)){var d=
angular.lowercase(k.substring(4)),c=b(a);m[d]=c}});var k=function(b){var k={};angular.forEach(b,function(b){var d=a.gmGetLatLng({object:b}),q=e(d);if(null!=q){var p=a.gmGetMarkerOptions({object:b}),f=q.toUrlValue(j.precision);if(k[f]=b,!j.hasMarker(d.lat,d.lng)){f={};angular.extend(f,p,{position:q});j.addMarker(f);var h=j.getMarker(d.lat,d.lng);angular.forEach(m,function(k,d){j.addListener(h,d,function(){c(function(){k(a.$parent.$parent,{object:b,marker:h})})})})}}});var d=[];j.forEachMarker(function(a){a.getPosition().toUrlValue(j.precision)in
k||d.push(a)});angular.forEach(d,function(a){a=a.getPosition();j.removeMarker(a.lat(),a.lng())});a.$emit("gmMarkersUpdated",f.gmObjects)};a.$watch("gmObjects().length",function(b,d){null!=b&&b!==d&&k(a.gmObjects())});a.$watch("gmObjects()",function(b,d){null!=b&&b!==d&&k(a.gmObjects())});a.$watch("gmEvents()",function(a,b){null!=a&&a!==b&&angular.forEach(a,function(a){var b=a.event;angular.forEach(a.locations,function(a){a=j.getMarker(a.lat(),a.lng());null!=a&&c(angular.bind(this,j.trigger,a,b))})})});
a.$on("gmMarkersRedraw",function(b,d){d===f.gmObjects&&(k(),k(a.gmObjects()))});c(angular.bind(null,k,a.gmObjects()))}}}])})();
(function(){angular.module("AngularGM").factory("angulargmContainer",["$q",function(a){var b={},c={};return{addMap:function(a,e){if(!(e instanceof google.maps.Map))throw"map not a google.maps.Map: "+e;if(a in b)throw"already contain map with id "+a;b[a]=e;a in c&&c[a].resolve(e)},getMap:function(a){return b[a]},getMapPromise:function(b){var e=c[b]||a.defer();return c[b]=e,e.promise},removeMap:function(a){a in b&&delete b[a];a in c&&delete c[a]},clear:function(){b={};c={}}}}])})();
(function(){angular.module("AngularGM").factory("angulargmUtils",[function(){function a(a,c){var d;if(a instanceof google.maps.LatLng&&c instanceof google.maps.LatLng){d=a.lat();var e=c.lat();if(d=1E-6>Math.abs(d-e))d=a.lng(),e=c.lng(),d=1E-6>Math.abs(d-e)}else d=!1;return d}return{latLngEqual:a,boundsEqual:function(b,c){if(!(b instanceof google.maps.LatLngBounds&&c instanceof google.maps.LatLngBounds))return!1;var d=b.getSouthWest(),e=c.getSouthWest(),g=b.getNorthEast(),h=c.getNorthEast();return a(d,
e)&&a(g,h)},latLngToObj:function(a){if(!(a instanceof google.maps.LatLng))throw"latLng not a google.maps.LatLng";return{lat:a.lat(),lng:a.lng()}},objToLatLng:function(a){if(null!=a){var c=a.lat;a=a.lng;if(!(null==c||null==a||isNaN(c)||isNaN(a)))return new google.maps.LatLng(c,a)}return null},hasNaN:function(a){if(!(a instanceof google.maps.LatLng))throw"latLng must be a google.maps.LatLng";var c=null==a.lat()||null==a.lng();a=isNaN(a.lat())||isNaN(a.lng());return c||a}}}])})();
(function(){angular.module("AngularGM").controller("angulargmMapController",["$scope","$element","angulargmUtils","angulargmDefaults","angulargmContainer",function(a,b,c,d,e){var g=c.latLngEqual,h=c.boundsEqual,f=c.hasNaN;this._getConfig=function(a,b){var k={};return angular.extend(k,b.mapOptions,a.gmMapOptions()),k};this._createMap=function(a,b,k,d){var c=d.getMap(a);if(c)throw"A map with id "+a+" already exists. You must use different ids for each instance of the angulargm directive.";return c=
new google.maps.Map(b[0],k),d.addMap(a,c),c};this._initDragListeners=function(){var a=this;this.addMapListener("dragstart",function(){a.dragging=!0});this.addMapListener("idle",function(){a.dragging=!1});this.addMapListener("drag",function(){a.dragging=!0})};this._destroy=function(a){e.removeMap(a)};this.addMapListener=function(a,b){google.maps.event.addListener(this._map,a,b)};this.addMapListenerOnce=function(a,b){google.maps.event.addListenerOnce(this._map,a,b)};this.addListener=function(a,b,k){google.maps.event.addListener(a,
b,k)};this.addListenerOnce=function(a,b,k){google.maps.event.addListenerOnce(a,b,k)};this.mapTrigger=function(a){google.maps.event.trigger(this._map,a)};this.trigger=function(a,b){google.maps.event.trigger(a,b)};this.addMarker=function(a){var b={};if(angular.extend(b,a),!(b.position instanceof google.maps.LatLng))throw"markerOptions did not contain a position";a=new google.maps.Marker(b);b=a.getPosition();if(this.hasMarker(b.lat(),b.lng()))return!1;b=b.toUrlValue(this.precision);return this._markers[b]=
a,a.setMap(this._map),!0};this.hasMarker=function(a,b){return this.getMarker(a,b)instanceof google.maps.Marker};this.getMarker=function(a,b){if(null==a||null==b)throw"lat or lng was null";var k=(new google.maps.LatLng(a,b)).toUrlValue(this.precision);return k in this._markers?this._markers[k]:null};this.removeMarker=function(a,b){if(null==a||null==b)throw"lat or lng was null";var k=!1,d=(new google.maps.LatLng(a,b)).toUrlValue(this.precision),c=this._markers[d];return c&&(c.setMap(null),k=!0),this._markers[d]=
null,delete this._markers[d],k};this.fitToMarkers=function(){var a=new google.maps.LatLngBounds;this.forEachMarker(function(b){a.extend(b.getPosition())});this.bounds=a};this.forEachMarker=function(a){if(null==a)throw"fn was null or undefined";angular.forEach(this._markers,function(b){null!=b&&a(b)})};angular.bind(this,function(a,b){var k=a.gmMapId();if(!k)throw"angulargm must have non-empty gmMapId attribute";var c=b.find("[id]");c.attr("id",k);var n=this._getConfig(a,d);this._map=this._createMap(k,
c,n,e);this._markers={};this.dragging=!1;Object.defineProperties(this,{precision:{value:3,writeable:!1},center:{configurable:!0,get:function(){return this._map.getCenter()},set:function(a){if(f(a))throw"center contains null or NaN";!g(this.center,a)&&this._map.panTo(a)}},zoom:{configurable:!0,get:function(){return this._map.getZoom()},set:function(a){if(null==a||isNaN(a))throw"zoom was null or NaN";this.zoom!==a&&this._map.setZoom(a)}},bounds:{configurable:!0,get:function(){return this._map.getBounds()},
set:function(a){if(f(a.getSouthWest())||f(a.getNorthEast()))throw"bounds contains null or NaN";!h(this.bounds,a)&&this._map.fitBounds(a)}}});this._initDragListeners();a.$on("$destroy",angular.bind(this,this._destroy,k))})(a,b)}])})();(function(){function a(a,b){var d=this,c=new google.maps.OverlayView;c.onAdd=function(){d.init_(a,b)};c.draw=function(){};c.onRemove=function(){};c.setMap(a);this.prjov_=c}var b=function(a){switch(a){case "thin":a="2px";break;case "medium":a="4px";break;case "thick":a="6px";break}return a},c=function(a){var d,c={};if(document.defaultView&&document.defaultView.getComputedStyle){if(d=a.ownerDocument.defaultView.getComputedStyle(a,""))return c.top=parseInt(d.borderTopWidth,10)||0,c.bottom=parseInt(d.borderBottomWidth,
10)||0,c.left=parseInt(d.borderLeftWidth,10)||0,c.right=parseInt(d.borderRightWidth,10)||0,c}else if(document.documentElement.currentStyle&&a.currentStyle)return c.top=parseInt(b(a.currentStyle.borderTopWidth),10)||0,c.bottom=parseInt(b(a.currentStyle.borderBottomWidth),10)||0,c.left=parseInt(b(a.currentStyle.borderLeftWidth),10)||0,c.right=parseInt(b(a.currentStyle.borderRightWidth),10)||0,c;c.top=parseInt(a.style["border-top-width"],10)||0;c.bottom=parseInt(a.style["border-bottom-width"],10)||0;
c.left=parseInt(a.style["border-left-width"],10)||0;c.right=parseInt(a.style["border-right-width"],10)||0;return c},d=0,e=0,g=function(){d="undefined"!==typeof document.documentElement.scrollLeft?document.documentElement.scrollLeft:document.body.scrollLeft;e="undefined"!==typeof document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop};g();var h=function(a){var b=0,c=0;a=a||window.event;"undefined"!==typeof a.pageX?(b=a.pageX,c=a.pageY):"undefined"!==typeof a.clientX&&
(b=a.clientX+d,c=a.clientY+e);return{left:b,top:c}},f=function(a){var b=a.offsetLeft,c=a.offsetTop;for(a=a.offsetParent;null!==a;){a!==document.body&&a!==document.documentElement&&(b-=a.scrollLeft,c-=a.scrollTop);var d=a,e=d.offsetLeft,f=d.offsetTop;if(!e&&!f&&window.getComputedStyle&&(d=document.defaultView.getComputedStyle(d,null).MozTransform||document.defaultView.getComputedStyle(d,null).WebkitTransform)&&"string"===typeof d)d=d.split(","),e+=parseInt(d[4],10)||0,f+=parseInt(d[5],10)||0;b+=e;
c+=f;a=a.offsetParent}return{left:b,top:c}},j=function(a,b){if(a&&b)for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},m=function(a,b){"undefined"!==typeof b&&(a.style.opacity=b);"undefined"!==typeof a.style.opacity&&""!==a.style.opacity&&(a.style.filter="alpha(opacity="+100*a.style.opacity+")")};a.prototype.init_=function(a,b){var d,e=this;this.map_=a;b=b||{};this.key_=b.key||"shift";this.key_=this.key_.toLowerCase();this.borderWidths_=c(this.map_.getDiv());this.veilDiv_=[];for(d=0;4>d;d++)this.veilDiv_[d]=
document.createElement("div"),this.veilDiv_[d].onselectstart=function(){return!1},j(this.veilDiv_[d].style,{backgroundColor:"gray",opacity:0.25,cursor:"crosshair"}),j(this.veilDiv_[d].style,b.paneStyle),j(this.veilDiv_[d].style,b.veilStyle),j(this.veilDiv_[d].style,{position:"absolute",overflow:"hidden",display:"none"}),"shift"===this.key_&&(this.veilDiv_[d].style.MozUserSelect="none"),m(this.veilDiv_[d]),"transparent"===this.veilDiv_[d].style.backgroundColor&&(this.veilDiv_[d].style.backgroundColor=
"white",m(this.veilDiv_[d],0)),this.map_.getDiv().appendChild(this.veilDiv_[d]);this.noZoom_=b.noZoom||!1;this.visualEnabled_=b.visualEnabled||!1;this.visualClass_=b.visualClass||"";this.visualPosition_=b.visualPosition||google.maps.ControlPosition.LEFT_TOP;this.visualPositionOffset_=b.visualPositionOffset||new google.maps.Size(35,0);this.visualPositionIndex_=b.visualPositionIndex||null;this.visualSprite_=b.visualSprite||"http"+("https:"===document.location.protocol?"s":"")+"://maps.gstatic.com/mapfiles/ftr/controls/dragzoom_btn.png";
this.visualSize_=b.visualSize||new google.maps.Size(20,20);this.visualTips_=b.visualTips||{};this.visualTips_.off=this.visualTips_.off||"Turn on drag zoom mode";this.visualTips_.on=this.visualTips_.on||"Turn off drag zoom mode";this.boxDiv_=document.createElement("div");j(this.boxDiv_.style,{border:"4px solid #736AFF"});j(this.boxDiv_.style,b.boxStyle);j(this.boxDiv_.style,{position:"absolute",display:"none"});m(this.boxDiv_);this.map_.getDiv().appendChild(this.boxDiv_);this.boxBorderWidths_=c(this.boxDiv_);
this.listeners_=[google.maps.event.addDomListener(document,"keydown",function(a){e.onKeyDown_(a)}),google.maps.event.addDomListener(document,"keyup",function(a){e.onKeyUp_(a)}),google.maps.event.addDomListener(this.veilDiv_[0],"mousedown",function(a){e.onMouseDown_(a)}),google.maps.event.addDomListener(this.veilDiv_[1],"mousedown",function(a){e.onMouseDown_(a)}),google.maps.event.addDomListener(this.veilDiv_[2],"mousedown",function(a){e.onMouseDown_(a)}),google.maps.event.addDomListener(this.veilDiv_[3],
"mousedown",function(a){e.onMouseDown_(a)}),google.maps.event.addDomListener(document,"mousedown",function(a){e.onMouseDownDocument_(a)}),google.maps.event.addDomListener(document,"mousemove",function(a){e.onMouseMove_(a)}),google.maps.event.addDomListener(document,"mouseup",function(a){e.onMouseUp_(a)}),google.maps.event.addDomListener(window,"scroll",g)];this.dragging_=this.mouseDown_=this.hotKeyDown_=!1;this.mapPosn_=this.mousePosn_=this.mapHeight_=this.mapWidth_=this.endPt_=this.startPt_=null;
this.visualEnabled_&&(this.buttonDiv_=this.initControl_(this.visualPositionOffset_),null!==this.visualPositionIndex_&&(this.buttonDiv_.index=this.visualPositionIndex_),this.map_.controls[this.visualPosition_].push(this.buttonDiv_),this.controlIndex_=this.map_.controls[this.visualPosition_].length-1)};a.prototype.initControl_=function(a){var b,d,c=this;b=document.createElement("div");b.className=this.visualClass_;b.style.position="relative";b.style.overflow="hidden";b.style.height=this.visualSize_.height+
"px";b.style.width=this.visualSize_.width+"px";b.title=this.visualTips_.off;d=document.createElement("img");d.src=this.visualSprite_;d.style.position="absolute";d.style.left=-(2*this.visualSize_.width)+"px";d.style.top="0px";b.appendChild(d);b.onclick=function(a){c.hotKeyDown_=!c.hotKeyDown_;c.hotKeyDown_?(c.buttonDiv_.firstChild.style.left=-(0*c.visualSize_.width)+"px",c.buttonDiv_.title=c.visualTips_.on,c.activatedByControl_=!0,google.maps.event.trigger(c,"activate")):(c.buttonDiv_.firstChild.style.left=
-(2*c.visualSize_.width)+"px",c.buttonDiv_.title=c.visualTips_.off,google.maps.event.trigger(c,"deactivate"));c.onMouseMove_(a)};b.onmouseover=function(){c.buttonDiv_.firstChild.style.left=-(1*c.visualSize_.width)+"px"};b.onmouseout=function(){c.hotKeyDown_?(c.buttonDiv_.firstChild.style.left=-(0*c.visualSize_.width)+"px",c.buttonDiv_.title=c.visualTips_.on):(c.buttonDiv_.firstChild.style.left=-(2*c.visualSize_.width)+"px",c.buttonDiv_.title=c.visualTips_.off)};b.ondragstart=function(){return!1};
j(b.style,{cursor:"pointer",marginTop:a.height+"px",marginLeft:a.width+"px"});return b};a.prototype.isHotKeyDown_=function(a){var b;a=a||window.event;b=a.shiftKey&&"shift"===this.key_||a.altKey&&"alt"===this.key_||a.ctrlKey&&"ctrl"===this.key_;if(!b)switch(a.keyCode){case 16:"shift"===this.key_&&(b=!0);break;case 17:"ctrl"===this.key_&&(b=!0);break;case 18:"alt"===this.key_&&(b=!0)}return b};a.prototype.isMouseOnMap_=function(){var a=this.mousePosn_;if(a){var b=this.mapPosn_,c=this.map_.getDiv();
return a.left>b.left&&a.left<b.left+c.offsetWidth&&a.top>b.top&&a.top<b.top+c.offsetHeight}return!1};a.prototype.setVeilVisibility_=function(){var a;if(this.map_&&this.hotKeyDown_&&this.isMouseOnMap_()){a=this.map_.getDiv();this.mapWidth_=a.offsetWidth-(this.borderWidths_.left+this.borderWidths_.right);this.mapHeight_=a.offsetHeight-(this.borderWidths_.top+this.borderWidths_.bottom);if(this.activatedByControl_){a=parseInt(this.buttonDiv_.style.left,10)+this.visualPositionOffset_.width;var b=parseInt(this.buttonDiv_.style.top,
10)+this.visualPositionOffset_.height,c=this.visualSize_.width,d=this.visualSize_.height;this.veilDiv_[0].style.top="0px";this.veilDiv_[0].style.left="0px";this.veilDiv_[0].style.width=a+"px";this.veilDiv_[0].style.height=this.mapHeight_+"px";this.veilDiv_[1].style.top="0px";this.veilDiv_[1].style.left=a+c+"px";this.veilDiv_[1].style.width=this.mapWidth_-(a+c)+"px";this.veilDiv_[1].style.height=this.mapHeight_+"px";this.veilDiv_[2].style.top="0px";this.veilDiv_[2].style.left=a+"px";this.veilDiv_[2].style.width=
c+"px";this.veilDiv_[2].style.height=b+"px";this.veilDiv_[3].style.top=b+d+"px";this.veilDiv_[3].style.left=a+"px";this.veilDiv_[3].style.width=c+"px";this.veilDiv_[3].style.height=this.mapHeight_-(b+d)+"px"}else{this.veilDiv_[0].style.left="0px";this.veilDiv_[0].style.top="0px";this.veilDiv_[0].style.width=this.mapWidth_+"px";this.veilDiv_[0].style.height=this.mapHeight_+"px";for(a=1;a<this.veilDiv_.length;a++)this.veilDiv_[a].style.width="0px",this.veilDiv_[a].style.height="0px"}for(a=0;a<this.veilDiv_.length;a++)this.veilDiv_[a].style.display=
"block"}else for(a=0;a<this.veilDiv_.length;a++)this.veilDiv_[a].style.display="none"};a.prototype.onKeyDown_=function(a){this.map_&&(!this.hotKeyDown_&&this.isHotKeyDown_(a))&&(this.mapPosn_=f(this.map_.getDiv()),this.hotKeyDown_=!0,this.activatedByControl_=!1,this.setVeilVisibility_(),google.maps.event.trigger(this,"activate"))};a.prototype.getMousePoint_=function(a){a=h(a);var b=new google.maps.Point;b.x=a.left-this.mapPosn_.left-this.borderWidths_.left;b.y=a.top-this.mapPosn_.top-this.borderWidths_.top;
b.x=Math.min(b.x,this.mapWidth_);b.y=Math.min(b.y,this.mapHeight_);b.x=Math.max(b.x,0);b.y=Math.max(b.y,0);return b};a.prototype.onMouseDown_=function(a){this.map_&&this.hotKeyDown_&&(this.mapPosn_=f(this.map_.getDiv()),this.dragging_=!0,this.startPt_=this.endPt_=this.getMousePoint_(a),this.boxDiv_.style.width=this.boxDiv_.style.height="0px",a=this.prjov_.getProjection().fromContainerPixelToLatLng(this.startPt_),google.maps.event.trigger(this,"dragstart",a))};a.prototype.onMouseDownDocument_=function(){this.mouseDown_=
!0};a.prototype.onMouseMove_=function(a){this.mousePosn_=h(a);if(this.dragging_){this.endPt_=this.getMousePoint_(a);a=Math.min(this.startPt_.x,this.endPt_.x);var b=Math.min(this.startPt_.y,this.endPt_.y),c=Math.abs(this.startPt_.x-this.endPt_.x),d=Math.abs(this.startPt_.y-this.endPt_.y),e=Math.max(0,c-(this.boxBorderWidths_.left+this.boxBorderWidths_.right)),j=Math.max(0,d-(this.boxBorderWidths_.top+this.boxBorderWidths_.bottom));this.veilDiv_[0].style.top="0px";this.veilDiv_[0].style.left="0px";
this.veilDiv_[0].style.width=a+"px";this.veilDiv_[0].style.height=this.mapHeight_+"px";this.veilDiv_[1].style.top="0px";this.veilDiv_[1].style.left=a+c+"px";this.veilDiv_[1].style.width=this.mapWidth_-(a+c)+"px";this.veilDiv_[1].style.height=this.mapHeight_+"px";this.veilDiv_[2].style.top="0px";this.veilDiv_[2].style.left=a+"px";this.veilDiv_[2].style.width=c+"px";this.veilDiv_[2].style.height=b+"px";this.veilDiv_[3].style.top=b+d+"px";this.veilDiv_[3].style.left=a+"px";this.veilDiv_[3].style.width=
c+"px";this.veilDiv_[3].style.height=this.mapHeight_-(b+d)+"px";this.boxDiv_.style.top=b+"px";this.boxDiv_.style.left=a+"px";this.boxDiv_.style.width=e+"px";this.boxDiv_.style.height=j+"px";this.boxDiv_.style.display="block";google.maps.event.trigger(this,"drag",new google.maps.Point(a,b+d),new google.maps.Point(a+c,b),this.prjov_.getProjection())}else this.mouseDown_||(this.mapPosn_=f(this.map_.getDiv()),this.setVeilVisibility_())};a.prototype.onMouseUp_=function(a){var b,c=this;this.mouseDown_=
!1;if(this.dragging_)if(this.getMousePoint_(a).x===this.startPt_.x&&this.getMousePoint_(a).y===this.startPt_.y)this.onKeyUp_(a);else{var d=Math.min(this.startPt_.x,this.endPt_.x),e=Math.min(this.startPt_.y,this.endPt_.y);b=Math.abs(this.startPt_.x-this.endPt_.x);var f=Math.abs(this.startPt_.y-this.endPt_.y),d=d+this.borderWidths_.left,e=e+this.borderWidths_.top,h=this.prjov_.getProjection(),f=h.fromContainerPixelToLatLng(new google.maps.Point(d,e+f)),e=h.fromContainerPixelToLatLng(new google.maps.Point(d+
b,e)),d=new google.maps.LatLngBounds(f,e);this.noZoom_?this.boxDiv_.style.display="none":(b=this.map_.getZoom(),this.map_.fitBounds(d),this.map_.getZoom()<b&&this.map_.setZoom(b),f=h.fromLatLngToContainerPixel(f),h=h.fromLatLngToContainerPixel(e),f.x-=this.borderWidths_.left,f.y-=this.borderWidths_.top,h.x-=this.borderWidths_.left,h.y-=this.borderWidths_.top,this.boxDiv_.style.left=f.x+"px",this.boxDiv_.style.top=h.y+"px",this.boxDiv_.style.width=Math.abs(h.x-f.x)-(this.boxBorderWidths_.left+this.boxBorderWidths_.right)+
"px",this.boxDiv_.style.height=Math.abs(h.y-f.y)-(this.boxBorderWidths_.top+this.boxBorderWidths_.bottom)+"px",setTimeout(function(){c.boxDiv_.style.display="none"},1E3));this.dragging_=!1;this.onMouseMove_(a);google.maps.event.trigger(this,"dragend",d);if(!this.isHotKeyDown_(a))this.onKeyUp_(a)}};a.prototype.onKeyUp_=function(){var a,b,c,d,e;b=null;if(this.map_&&this.hotKeyDown_){this.hotKeyDown_=!1;this.dragging_&&(this.boxDiv_.style.display="none",this.dragging_=!1,a=Math.min(this.startPt_.x,this.endPt_.x),
b=Math.min(this.startPt_.y,this.endPt_.y),c=Math.abs(this.startPt_.x-this.endPt_.x),d=Math.abs(this.startPt_.y-this.endPt_.y),e=this.prjov_.getProjection(),d=e.fromContainerPixelToLatLng(new google.maps.Point(a,b+d)),a=e.fromContainerPixelToLatLng(new google.maps.Point(a+c,b)),b=new google.maps.LatLngBounds(d,a));for(a=0;a<this.veilDiv_.length;a++)this.veilDiv_[a].style.display="none";this.visualEnabled_&&(this.buttonDiv_.firstChild.style.left=-(2*this.visualSize_.width)+"px",this.buttonDiv_.title=
this.visualTips_.off,this.buttonDiv_.style.display="");google.maps.event.trigger(this,"deactivate",b)}};google.maps.Map.prototype.enableKeyDragZoom=function(b){this.dragZoom_=new a(this,b)};google.maps.Map.prototype.disableKeyDragZoom=function(){var a,b=this.dragZoom_;if(b){for(a=0;a<b.listeners_.length;++a)google.maps.event.removeListener(b.listeners_[a]);this.getDiv().removeChild(b.boxDiv_);for(a=0;a<b.veilDiv_.length;a++)this.getDiv().removeChild(b.veilDiv_[a]);b.visualEnabled_&&this.controls[b.visualPosition_].removeAt(b.controlIndex_);
b.prjov_.setMap(null);this.dragZoom_=null}};google.maps.Map.prototype.keyDragZoomEnabled=function(){return null!==this.dragZoom_};google.maps.Map.prototype.getDragZoomObject=function(){return this.dragZoom_}})();angular.module("ui.bootstrap","ui.bootstrap.transition ui.bootstrap.collapse ui.bootstrap.accordion ui.bootstrap.alert ui.bootstrap.buttons ui.bootstrap.carousel ui.bootstrap.dialog ui.bootstrap.dropdownToggle ui.bootstrap.modal ui.bootstrap.pagination ui.bootstrap.tooltip ui.bootstrap.popover ui.bootstrap.progressbar ui.bootstrap.tabs ui.bootstrap.typeahead".split(" "));
angular.module("ui.bootstrap.transition",[]).factory("$transition",["$q","$timeout","$rootScope",function(a,b,c){function d(a){for(var b in a)if(void 0!==g.style[b])return a[b]}var e=function(d,f,j){j=j||{};var g=a.defer(),k=e[j.animation?"animationEndEventName":"transitionEndEventName"],q=function(){c.$apply(function(){d.unbind(k,q);g.resolve(d)})};k&&d.bind(k,q);b(function(){angular.isString(f)?d.addClass(f):angular.isFunction(f)?f(d):angular.isObject(f)&&d.css(f);k||g.resolve(d)});g.promise.cancel=
function(){k&&d.unbind(k,q);g.reject("Transition cancelled")};return g.promise},g=document.createElement("trans");e.transitionEndEventName=d({WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",transition:"transitionend"});e.animationEndEventName=d({WebkitTransition:"webkitAnimationEnd",MozTransition:"animationend",OTransition:"oAnimationEnd",transition:"animationend"});return e}]);
angular.module("ui.bootstrap.collapse",["ui.bootstrap.transition"]).directive("collapse",["$transition",function(a){var b=function(a,b,e){b.removeClass("collapse");b.css({height:e});b.addClass("collapse")};return{link:function(c,d,e){var g,h=!0;c.$watch(function(){return d[0].scrollHeight},function(){0!==d[0].scrollHeight&&(g||(h?b(c,d,d[0].scrollHeight+"px"):b(c,d,"auto")))});c.$watch(e.collapse,function(a){a?(g=!0,h?(h=!1,b(c,d,0)):(b(c,d,d[0].scrollHeight+"px"),j({height:"0"}))):(h?(h=!1,g||b(c,
d,"auto")):j({height:d[0].scrollHeight+"px"}).then(function(){g||b(c,d,"auto")}),g=!1)});var f,j=function(b){f&&f.cancel();f=a(d,b);f.then(function(){f=void 0},function(){f=void 0});return f}}}}]);
angular.module("ui.bootstrap.accordion",["ui.bootstrap.collapse"]).constant("accordionConfig",{closeOthers:!0}).controller("AccordionController",["$scope","$attrs","accordionConfig",function(a,b,c){this.groups=[];this.closeOthers=function(d){(angular.isDefined(b.closeOthers)?a.$eval(b.closeOthers):c.closeOthers)&&angular.forEach(this.groups,function(a){a!==d&&(a.isOpen=!1)})};this.addGroup=function(a){var b=this;this.groups.push(a);a.$on("$destroy",function(){b.removeGroup(a)})};this.removeGroup=
function(a){-1!==this.groups.indexOf(a)&&this.groups.splice(this.groups.indexOf(a),1)}}]).directive("accordion",function(){return{restrict:"EA",controller:"AccordionController",transclude:!0,replace:!1,templateUrl:"template/accordion/accordion.html"}}).directive("accordionGroup",["$parse","$transition","$timeout",function(a){return{require:"^accordion",restrict:"EA",transclude:!0,replace:!0,templateUrl:"template/accordion/accordion-group.html",scope:{heading:"@"},controller:["$scope",function(){this.setHeading=
function(a){this.heading=a}}],link:function(b,c,d,e){var g,h;e.addGroup(b);b.isOpen=!1;d.isOpen&&(g=a(d.isOpen),h=g.assign,b.$watch(function(){return g(b.$parent)},function(a){b.isOpen=a}),b.isOpen=g?g(b.$parent):!1);b.$watch("isOpen",function(a){a&&e.closeOthers(b);h&&h(b.$parent,a)})}}}]).directive("accordionHeading",function(){return{restrict:"E",transclude:!0,template:"",replace:!0,require:"^accordionGroup",compile:function(a,b,c){return function(a,b,g,h){h.setHeading(c(a,function(){}))}}}}).directive("accordionTransclude",
function(){return{require:"^accordionGroup",link:function(a,b,c,d){a.$watch(function(){return d[c.accordionTransclude]},function(a){a&&(b.html(""),b.append(a))})}}});angular.module("ui.bootstrap.alert",[]).directive("alert",function(){return{restrict:"EA",templateUrl:"template/alert/alert.html",transclude:!0,replace:!0,scope:{type:"=",close:"&"},link:function(a,b,c){a.closeable="close"in c}}});
angular.module("ui.bootstrap.buttons",[]).constant("buttonConfig",{activeClass:"active",toggleEvent:"click"}).directive("btnRadio",["buttonConfig",function(a){var b=a.activeClass||"active",c=a.toggleEvent||"click";return{require:"ngModel",link:function(a,e,g,h){var f=a.$eval(g.btnRadio);a.$watch(function(){return h.$modelValue},function(a){angular.equals(a,f)?e.addClass(b):e.removeClass(b)});e.bind(c,function(){e.hasClass(b)||a.$apply(function(){h.$setViewValue(f)})})}}}]).directive("btnCheckbox",
["buttonConfig",function(a){var b=a.activeClass||"active",c=a.toggleEvent||"click";return{require:"ngModel",link:function(a,e,g,h){var f=a.$eval(g.btnCheckboxTrue),j=a.$eval(g.btnCheckboxFalse),f=angular.isDefined(f)?f:!0,j=angular.isDefined(j)?j:!1;a.$watch(function(){return h.$modelValue},function(a){angular.equals(a,f)?e.addClass(b):e.removeClass(b)});e.bind(c,function(){a.$apply(function(){h.$setViewValue(e.hasClass(b)?j:f)})})}}}]);
angular.module("ui.bootstrap.carousel",["ui.bootstrap.transition"]).controller("CarouselController",["$scope","$timeout","$transition","$q",function(a,b,c){function d(){function c(){j?(a.next(),d()):a.pause()}f&&b.cancel(f);var e=+a.interval;!isNaN(e)&&0<=e&&(f=b(c,e))}var e=this,g=e.slides=[],h=-1,f,j;e.currentSlide=null;e.select=function(f,j){function q(){if(e.currentSlide&&angular.isString(j)&&!a.noTransition&&f.$element){f.$element.addClass(j);f.$element.attr("offsetWidth",f.$element[0].offsetWidth);
angular.forEach(g,function(a){angular.extend(a,{direction:"",entering:!1,leaving:!1,active:!1})});angular.extend(f,{direction:j,active:!0,entering:!0});angular.extend(e.currentSlide||{},{direction:j,leaving:!0});a.$currentTransition=c(f.$element,{});var b=f,l=e.currentSlide;a.$currentTransition.then(function(){n(b,l)},function(){n(b,l)})}else n(f,e.currentSlide);e.currentSlide=f;h=p;d()}function n(b,c){angular.extend(b,{direction:"",active:!0,leaving:!1,entering:!1});angular.extend(c||{},{direction:"",
active:!1,leaving:!1,entering:!1});a.$currentTransition=null}var p=g.indexOf(f);void 0===j&&(j=p>h?"next":"prev");f&&f!==e.currentSlide&&(a.$currentTransition?(a.$currentTransition.cancel(),b(q)):q())};e.indexOfSlide=function(a){return g.indexOf(a)};a.next=function(){return e.select(g[(h+1)%g.length],"next")};a.prev=function(){return e.select(g[0>h-1?g.length-1:h-1],"prev")};a.select=function(a){e.select(a)};a.isActive=function(a){return e.currentSlide===a};a.slides=function(){return g};a.$watch("interval",
d);a.play=function(){j||(j=!0,d())};a.pause=function(){j=!1;f&&b.cancel(f)};e.addSlide=function(b,c){b.$element=c;g.push(b);1===g.length||b.active?(e.select(g[g.length-1]),1==g.length&&a.play()):b.active=!1};e.removeSlide=function(a){var b=g.indexOf(a);g.splice(b,1);0<g.length&&a.active&&(b>=g.length?e.select(g[b-1]):e.select(g[b]))}}]).directive("carousel",[function(){return{restrict:"EA",transclude:!0,replace:!0,controller:"CarouselController",require:"carousel",templateUrl:"template/carousel/carousel.html",
scope:{interval:"=",noTransition:"="}}}]).directive("slide",[function(){return{require:"^carousel",restrict:"EA",transclude:!0,replace:!0,templateUrl:"template/carousel/slide.html",scope:{active:"="},link:function(a,b,c,d){d.addSlide(a,b);a.$on("$destroy",function(){d.removeSlide(a)});a.$watch("active",function(b){b&&d.select(a)})}}}]);var dialogModule=angular.module("ui.bootstrap.dialog",["ui.bootstrap.transition"]);
dialogModule.controller("MessageBoxController",["$scope","dialog","model",function(a,b,c){a.title=c.title;a.message=c.message;a.buttons=c.buttons;a.close=function(a){b.close(a)}}]);
dialogModule.provider("$dialog",function(){var a={backdrop:!0,dialogClass:"modal",backdropClass:"modal-backdrop",transitionClass:"fade",triggerClass:"in",dialogOpenClass:"modal-open",resolve:{},backdropFade:!1,dialogFade:!1,keyboard:!0,backdropClick:!0},b={},c=0;this.options=function(a){b=a};this.$get=["$http","$document","$compile","$rootScope","$controller","$templateCache","$q","$transition","$injector",function(d,e,g,h,f,j,m,k,q){function n(a){var b=angular.element("<div>");b.addClass(a);return b}
function p(c){var d=this;c=this.options=angular.extend({},a,b,c);this._open=!1;this.backdropEl=n(c.backdropClass);c.backdropFade&&(this.backdropEl.addClass(c.transitionClass),this.backdropEl.removeClass(c.triggerClass));this.modalEl=n(c.dialogClass);c.dialogFade&&(this.modalEl.addClass(c.transitionClass),this.modalEl.removeClass(c.triggerClass));this.handledEscapeKey=function(a){27===a.which&&(d.close(),a.preventDefault(),d.$scope.$apply())};this.handleBackDropClick=function(a){d.close();a.preventDefault();
d.$scope.$apply()}}var r=e.find("body");p.prototype.isOpen=function(){return this._open};p.prototype.open=function(a,b){var c=this,d=this.options;a&&(d.templateUrl=a);b&&(d.controller=b);if(!d.template&&!d.templateUrl)throw Error("Dialog.open expected template or templateUrl, neither found. Use options or open method to specify them.");this._loadResolves().then(function(a){var b=a.$scope=c.$scope=a.$scope?a.$scope:h.$new();c.modalEl.html(a.$template);c.options.controller&&(a=f(c.options.controller,
a),c.modalEl.contents().data("ngControllerController",a));g(c.modalEl)(b);c._addElementsToDom();r.addClass(c.options.dialogOpenClass);setTimeout(function(){c.options.dialogFade&&c.modalEl.addClass(c.options.triggerClass);c.options.backdropFade&&c.backdropEl.addClass(c.options.triggerClass)});c._bindEvents()});this.deferred=m.defer();return this.deferred.promise};p.prototype.close=function(a){function b(a){a.removeClass(d.options.triggerClass)}function c(){d._open&&d._onCloseComplete(a)}var d=this,
e=this._getFadingElements();r.removeClass(d.options.dialogOpenClass);if(0<e.length)for(var f=e.length-1;0<=f;f--)k(e[f],b).then(c);else this._onCloseComplete(a)};p.prototype._getFadingElements=function(){var a=[];this.options.dialogFade&&a.push(this.modalEl);this.options.backdropFade&&a.push(this.backdropEl);return a};p.prototype._bindEvents=function(){this.options.keyboard&&r.bind("keydown",this.handledEscapeKey);this.options.backdrop&&this.options.backdropClick&&this.backdropEl.bind("click",this.handleBackDropClick)};
p.prototype._unbindEvents=function(){this.options.keyboard&&r.unbind("keydown",this.handledEscapeKey);this.options.backdrop&&this.options.backdropClick&&this.backdropEl.unbind("click",this.handleBackDropClick)};p.prototype._onCloseComplete=function(a){this._removeElementsFromDom();this._unbindEvents();this.deferred.resolve(a)};p.prototype._addElementsToDom=function(){r.append(this.modalEl);this.options.backdrop&&(0===c&&r.append(this.backdropEl),c++);this._open=!0};p.prototype._removeElementsFromDom=
function(){this.modalEl.remove();this.options.backdrop&&(c--,0===c&&this.backdropEl.remove());this._open=!1};p.prototype._loadResolves=function(){var a=[],b=[],c,e=this;this.options.template?c=m.when(this.options.template):this.options.templateUrl&&(c=d.get(this.options.templateUrl,{cache:j}).then(function(a){return a.data}));angular.forEach(this.options.resolve||[],function(c,d){b.push(d);a.push(angular.isString(c)?q.get(c):q.invoke(c))});b.push("$template");a.push(c);return m.all(a).then(function(a){var c=
{};angular.forEach(a,function(a,d){c[b[d]]=a});c.dialog=e;return c})};return{dialog:function(a){return new p(a)},messageBox:function(a,b,c){return new p({templateUrl:"template/dialog/message.html",controller:"MessageBoxController",resolve:{model:function(){return{title:a,message:b,buttons:c}}}})}}}]});
angular.module("ui.bootstrap.dropdownToggle",[]).directive("dropdownToggle",["$document","$location","$window",function(a){var b=null,c=angular.noop;return{restrict:"CA",link:function(d,e){d.$watch("$location.path",function(){c()});e.parent().bind("click",function(){c()});e.bind("click",function(d){d.preventDefault();d.stopPropagation();d=e===b;b&&c();d||(e.parent().addClass("open"),b=e,c=function(d){d&&(d.preventDefault(),d.stopPropagation());a.unbind("click",c);e.parent().removeClass("open");c=
angular.noop;b=null},a.bind("click",c))})}}}]);
angular.module("ui.bootstrap.modal",["ui.bootstrap.dialog"]).directive("modal",["$parse","$dialog",function(a,b){return{restrict:"EA",terminal:!0,link:function(c,d,e){var g=angular.extend({},c.$eval(e.uiOptions||e.bsOptions||e.options)),h=e.modal||e.show,f,g=angular.extend(g,{template:d.html(),resolve:{$scope:function(){return c}}}),j=b.dialog(g);d.remove();f=e.close?function(){a(e.close)(c)}:function(){angular.isFunction(a(h).assign)&&a(h).assign(c,!1)};c.$watch(h,function(a){a?j.open().then(function(){f()}):
j.isOpen()&&j.close()})}}}]);
angular.module("ui.bootstrap.pagination",[]).constant("paginationConfig",{boundaryLinks:!1,directionLinks:!0,firstText:"First",previousText:"Previous",nextText:"Next",lastText:"Last"}).directive("pagination",["paginationConfig",function(a){return{restrict:"EA",scope:{numPages:"=",currentPage:"=",maxSize:"=",onSelectPage:"&"},templateUrl:"template/pagination/pagination.html",replace:!0,link:function(b,c,d){function e(a,b,c,d){return{number:a,text:b,active:c,disabled:d}}var g=angular.isDefined(d.boundaryLinks)?
b.$eval(d.boundaryLinks):a.boundaryLinks,h=angular.isDefined(d.directionLinks)?b.$eval(d.directionLinks):a.directionLinks,f=angular.isDefined(d.firstText)?d.firstText:a.firstText,j=angular.isDefined(d.previousText)?d.previousText:a.previousText,m=angular.isDefined(d.nextText)?d.nextText:a.nextText,k=angular.isDefined(d.lastText)?d.lastText:a.lastText;b.$watch("numPages + currentPage + maxSize",function(){b.pages=[];var a=1,c=b.numPages;b.maxSize&&b.maxSize<b.numPages&&(a=Math.max(b.currentPage-Math.floor(b.maxSize/
2),1),c=a+b.maxSize-1,c>b.numPages&&(c=b.numPages,a=c-b.maxSize+1));for(;a<=c;a++){var d=e(a,a,b.isActive(a),!1);b.pages.push(d)}h&&(c=e(b.currentPage-1,j,!1,b.noPrevious()),b.pages.unshift(c),c=e(b.currentPage+1,m,!1,b.noNext()),b.pages.push(c));g&&(c=e(1,f,!1,b.noPrevious()),b.pages.unshift(c),c=e(b.numPages,k,!1,b.noNext()),b.pages.push(c));b.currentPage>b.numPages&&b.selectPage(b.numPages)});b.noPrevious=function(){return 1===b.currentPage};b.noNext=function(){return b.currentPage===b.numPages};
b.isActive=function(a){return b.currentPage===a};b.selectPage=function(a){!b.isActive(a)&&(0<a&&a<=b.numPages)&&(b.currentPage=a,b.onSelectPage({page:a}))}}}}]);
angular.module("ui.bootstrap.tooltip",[]).provider("$tooltip",function(){var a={placement:"top",animation:!0,popupDelay:0},b={};this.options=function(a){angular.extend(b,a)};this.$get=["$window","$compile","$timeout","$parse","$document",function(c,d,e,g,h){return function(f,j,m,k){var q=angular.extend({},a,b),n;n=f.replace(/[A-Z]/g,function(a,b){return(b?"-":"")+a.toLowerCase()});var p="<"+n+'-popup title="{{tt_title}}" content="{{tt_content}}" placement="{{tt_placement}}" animation="tt_animation()" is-open="tt_isOpen"></'+
n+"-popup>";return{restrict:"EA",scope:!0,link:function(a,b,n){function w(){a.tt_popupDelay?z=e(x,a.tt_popupDelay):a.$apply(x)}function x(){var d,f,j,g,k,p;if(a.tt_content){u&&e.cancel(u);s.css({top:0,left:0,display:"block"});q.appendToBody?(v=v||h.find("body"),v.append(s)):b.after(s);f=b;g=f[0].getBoundingClientRect();d=f.prop("offsetWidth");f=f.prop("offsetHeight");j=g.top+c.pageYOffset;g=g.left+c.pageXOffset;k=s.prop("offsetWidth");p=s.prop("offsetHeight");switch(a.tt_placement){case "right":d=
{top:j+f/2-p/2+"px",left:g+d+"px"};break;case "bottom":d={top:j+f+"px",left:g+d/2-k/2+"px"};break;case "left":d={top:j+f/2-p/2+"px",left:g-k+"px"};break;default:d={top:j-p+"px",left:g+d/2-k/2+"px"}}s.css(d);a.tt_isOpen=!0}}function y(){a.tt_isOpen=!1;e.cancel(z);angular.isDefined(a.tt_animation)&&a.tt_animation()?u=e(function(){s.remove()},500):s.remove()}var s=d(p)(a),u,z,v;n.$observe(f,function(b){a.tt_content=b});n.$observe(j+"Title",function(b){a.tt_title=b});n.$observe(j+"Placement",function(b){a.tt_placement=
angular.isDefined(b)?b:q.placement});n.$observe(j+"Animation",function(b){a.tt_animation=angular.isDefined(b)?g(b):function(){return q.animation}});n.$observe(j+"PopupDelay",function(b){b=parseInt(b,10);a.tt_popupDelay=!isNaN(b)?b:q.popupDelay});a.tt_isOpen=!1;angular.isDefined(k)?(b.bind(m,function(){w()}),b.bind(k,function(){a.$apply(y)})):b.bind(m,function(){a.tt_isOpen?a.$apply(y):w()})}}}}]}).directive("tooltipPopup",function(){return{restrict:"E",replace:!0,scope:{content:"@",placement:"@",
animation:"&",isOpen:"&"},templateUrl:"template/tooltip/tooltip-popup.html"}}).directive("tooltip",["$tooltip",function(a){return a("tooltip","tooltip","mouseenter","mouseleave")}]).directive("tooltipHtmlUnsafePopup",function(){return{restrict:"E",replace:!0,scope:{content:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"template/tooltip/tooltip-html-unsafe-popup.html"}}).directive("tooltipHtmlUnsafe",["$tooltip",function(a){return a("tooltipHtmlUnsafe","tooltip","mouseenter","mouseleave")}]);
angular.module("ui.bootstrap.popover",["ui.bootstrap.tooltip"]).directive("popoverPopup",function(){return{restrict:"EA",replace:!0,scope:{title:"@",content:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"template/popover/popover.html"}}).directive("popover",["$compile","$timeout","$parse","$window","$tooltip",function(a,b,c,d,e){return e("popover","popover","click")}]);
angular.module("ui.bootstrap.progressbar",["ui.bootstrap.transition"]).constant("progressConfig",{animate:!0,autoType:!1,stackedTypes:["success","info","warning","danger"]}).controller("ProgressBarController",["$scope","$attrs","progressConfig",function(a,b,c){var d=angular.isDefined(b.animate)?a.$eval(b.animate):c.animate,e=angular.isDefined(b.autoType)?a.$eval(b.autoType):c.autoType,g=angular.isDefined(b.stackedTypes)?a.$eval("["+b.stackedTypes+"]"):c.stackedTypes;this.makeBar=function(a,b,c){var m=
angular.isObject(a)?a.value:a||0;b=angular.isObject(b)?b.value:b||0;a=angular.isObject(a)&&angular.isDefined(a.type)?a.type:e?g[c||0]:null;return{from:b,to:m,type:a,animate:d}};this.addBar=function(b){a.bars.push(b);a.totalPercent+=b.to};this.clearBars=function(){a.bars=[];a.totalPercent=0};this.clearBars()}]).directive("progress",function(){return{restrict:"EA",replace:!0,controller:"ProgressBarController",scope:{value:"=",onFull:"&",onEmpty:"&"},templateUrl:"template/progressbar/progress.html",
link:function(a,b,c,d){a.$watch("value",function(a,b){d.clearBars();if(angular.isArray(a))for(var c=0,f=a.length;c<f;c++)d.addBar(d.makeBar(a[c],b[c],c));else d.addBar(d.makeBar(a,b))},!0);a.$watch("totalPercent",function(b){if(100<=b)a.onFull();else if(0>=b)a.onEmpty()},!0)}}}).directive("progressbar",["$transition",function(a){return{restrict:"EA",replace:!0,scope:{width:"=",old:"=",type:"=",animate:"="},templateUrl:"template/progressbar/bar.html",link:function(b,c){b.$watch("width",function(d){b.animate?
(c.css("width",b.old+"%"),a(c,{width:d+"%"})):c.css("width",d+"%")})}}}]);
angular.module("ui.bootstrap.tabs",[]).controller("TabsController",["$scope","$element",function(a){var b=a.panes=[];this.select=a.select=function(a){angular.forEach(b,function(a){a.selected=!1});a.selected=!0};this.addPane=function(c){b.length||a.select(c);b.push(c)};this.removePane=function(c){var d=b.indexOf(c);b.splice(d,1);c.selected&&0<b.length&&a.select(b[d<b.length?d:d-1])}}]).directive("tabs",function(){return{restrict:"EA",transclude:!0,scope:{},controller:"TabsController",templateUrl:"template/tabs/tabs.html",
replace:!0}}).directive("pane",["$parse",function(a){return{require:"^tabs",restrict:"EA",transclude:!0,scope:{heading:"@"},link:function(b,c,d,e){var g,h;b.selected=!1;d.active&&(g=a(d.active),h=g.assign,b.$watch(function(){return g(b.$parent)},function(a){b.selected=a}),b.selected=g?g(b.$parent):!1);b.$watch("selected",function(a){a&&e.select(b);h&&h(b.$parent,a)});e.addPane(b);b.$on("$destroy",function(){e.removePane(b)})},templateUrl:"template/tabs/pane.html",replace:!0}}]);
angular.module("ui.bootstrap.typeahead",[]).factory("typeaheadParser",["$parse",function(a){var b=/^\s*(.*?)(?:\s+as\s+(.*?))?\s+for\s+(?:([\$\w][\$\w\d]*))\s+in\s+(.*)$/;return{parse:function(c){var d=c.match(b);if(!d)throw Error("Expected typeahead specification in form of '_modelValue_ (as _label_)? for _item_ in _collection_' but got '"+c+"'.");return{itemName:d[3],source:a(d[4]),viewMapper:a(d[2]||d[1]),modelMapper:a(d[1])}}}}]).directive("typeahead",["$compile","$parse","$q","$document","typeaheadParser",
function(a,b,c,d,e){var g=[9,13,27,38,40];return{require:"ngModel",link:function(h,f,j,m){var k,q=h.$eval(j.typeaheadMinLength)||1,n=e.parse(j.typeahead),p=!1!==h.$eval(j.typeaheadEditable),r=b(j.typeaheadLoading).assign||angular.noop,l=h.$new();h.$on("$destroy",function(){l.$destroy()});var t=function(){l.matches=[];l.activeIdx=-1};t();l.query=void 0;m.$parsers.push(function(a){t();if(k)return a;if(a&&a.length>=q){var b={$viewValue:a};r(h,!0);c.when(n.source(l,b)).then(function(c){if(a===m.$viewValue){if(0<
c.length){l.activeIdx=0;for(var d=l.matches.length=0;d<c.length;d++)b[n.itemName]=c[d],l.matches.push({label:n.viewMapper(l,b),model:c[d]});l.query=a}else t();r(h,!1)}},function(){t();r(h,!1)})}return p?a:void 0});m.$render=function(){var a={};a[n.itemName]=k||m.$viewValue;f.val(n.viewMapper(l,a)||m.$viewValue);k=void 0};l.select=function(a){var b={};b[n.itemName]=k=l.matches[a].model;m.$setViewValue(n.modelMapper(l,b));m.$render()};f.bind("keydown",function(a){0===l.matches.length||-1===g.indexOf(a.which)||
(a.preventDefault(),40===a.which?(l.activeIdx=(l.activeIdx+1)%l.matches.length,l.$digest()):38===a.which?(l.activeIdx=(l.activeIdx?l.activeIdx:l.matches.length)-1,l.$digest()):13===a.which||9===a.which?l.$apply(function(){l.select(l.activeIdx)}):27===a.which&&(a.stopPropagation(),t(),l.$digest()))});d.find("body").bind("click",function(){t();l.$digest()});j=a("<typeahead-popup matches='matches' active='activeIdx' select='select(activeIdx)' query='query'></typeahead-popup>")(l);f.after(j)}}}]).directive("typeaheadPopup",
function(){return{restrict:"E",scope:{matches:"=",query:"=",active:"=",select:"&"},replace:!0,templateUrl:"template/typeahead/typeahead.html",link:function(a){a.isOpen=function(){return 0<a.matches.length};a.isActive=function(b){return a.active==b};a.selectActive=function(b){a.active=b};a.selectMatch=function(b){a.select({activeIdx:b})}}}}).filter("typeaheadHighlight",function(){return function(a,b){return b?a.replace(RegExp(b.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"),"gi"),"<strong>$&</strong>"):
b}});(function(){angular.module("hutmap","hutmap.services hutmap.directives hutmap.filters hutmap.controllers AngularGM ngResource ui.bootstrap".split(" ")).config(["$routeProvider","$locationProvider","PlacesProvider",function(a,b,c){a.when("/",{templateUrl:"/partials/home.html",activetab:"home"}).when("/map/",{templateUrl:"/partials/map.html",activetab:"map",reloadOnSearch:!1}).when("/about/",{templateUrl:"/partials/about.html",activetab:"about"});b.html5Mode(!0);c.bounds(new google.maps.LatLngBounds(new google.maps.LatLng(30,
-130),new google.maps.LatLng(65,-80)))}]).constant("hutmapMapId","map_canvas").value("mapOptions",{zoom:8,center:new google.maps.LatLng(46.87916,-120),mapTypeId:google.maps.MapTypeId.TERRAIN,streetViewControl:!1}).value("markerOptions",{huts:{icon:"/static/img/marker_gray_small.png",shape:{coord:[6,0,2,2,0,6,6,13,12,6,10,2,6,0],type:"poly"},zIndex:0},filteredHuts:{icon:"/static/img/marker_red_small.png",shape:{coord:[6,0,2,2,0,6,6,13,12,6,10,2,6,0],type:"poly"},zIndex:1},selected:{icon:"/static/img/marker_yellow_small.png",
zIndex:2}})})();(function(){angular.module("hutmap.filters",[]).filter("truncate",function(){return function(a,b,c){isNaN(b)&&(b=10);void 0===c&&(c="...");return null==a||0==a.length?null:a.length<=b||a.length-c.length<=b?a:String(a).substring(0,b-c.length)+c}})})();(function(){angular.module("hutmap.directives",[]).directive("blur",["$parse",function(a){return function(b,c,d){var e=a(d.blur);c.bind("blur",function(){e(b)})}}])})();(function(){angular.module("hutmap.controllers").controller("HutCtrl",["$scope","$location","$timeout","Huts",function(a,b,c,d){var e=0;a.loading=0;a.huts;a.filteredHuts;a.filteredHutIds;a.totalHutCount;a.query;a.selectedHut;a.selectedHutRegion;a.selectedHutAgency;a.loadNewHuts=!0;a.gridOptions={data:"filteredHuts",showFilter:!1,columnDefs:[{field:"name",displayName:"Name"}]};a.resetLoading=function(){a.loading=0};a.incLoading=function(){a.loading++};a.decLoading=function(){0<a.loading&&a.loading--};
a.setQuery=function(b){a.query=b};a.setFilteredHuts=function(b,c){a.filteredHuts=b;a.filteredHutIds=c};a.setSelectedHut=function(b){if(a.selectedHut=b)d.agency(b.agency).then(function(b){a.selectedHutAgency=b}),d.region(b.region).then(function(b){a.selectedHutRegion=b})};a.$watch("query",function(b){if(null!=b){var h=++e;c(function(){h===e&&b&&(a.incLoading(),d.query(b).then(function(b){a.decLoading();h===e&&(a.resetLoading(),a.huts=b)},function(){a.decLoading()}))},1E3)}});d.totalHutCount().then(function(b){a.totalHutCount=
b})}])})();(function(){angular.module("hutmap.controllers").controller("HutImgCtrl",["$scope",function(a){a.getImgUrl=function(b,c,d){var e="";b&&(e=b.photo_url?b.photo_url:!b.photo_url&&3===b.accuracy||5===b.accuracy?"http://maps.googleapis.com/maps/api/staticmap?center="+b.location.coordinates[1]+"%2C"+b.location.coordinates[0]+"&zoom=19&size="+c+"x"+d+"&maptype=satellite&sensor=false&key="+a.GOOGLE_API_KEY:a.STATIC_URL+"img/no-image-available.gif");return e}}])})();(function(){angular.module("hutmap.controllers").controller("CarouselCtrl",["$scope","$route","$http","$q",function(a,b,c,d){a.slides=[{title:"Plummer Hut",location:"Waddington Range, British Columbia, Canada",hutLink:"/map/?m_selected=51.37361,-125.16458&m_center=51.388403,-125.062053&m_zoom=9",agency:{name:"BC Mountaineering Club",url:""},thumbnail:"/static/img/no-image-available.gif",image:"/static/img/carousel/Plummer Hut.JPG"},{title:"Joe River Chickee",location:"lorem ipsum dolor",hutLink:"",
agency:{name:"lorem ipsum dolor",url:""},thumbnail:"/static/img/no-image-available.gif",image:"/static/img/carousel/Joe River Chickee.JPG"},{title:"John Muir Shelter",location:"lorem ipsum dolor",hutLink:"",agency:{name:"lorem ipsum dolor",url:""},thumbnail:"/static/img/no-image-available.gif",image:"/static/img/carousel/John Muir Shelter.JPG"}];a.imgStyle=function(a){return{"background-image":"url('"+a+"')"}};a.carouselInterval=-1;var e=[];angular.forEach(a.slides,function(a){e.push(c.get(a.image))});
d.all(e).then(function(){a.carouselInterval=8E3})}])})();(function(){angular.module("hutmap.controllers",[])})();(function(){angular.module("hutmap.controllers").controller("SearchCtrl",["$scope","$location","$route","$log","$q","$document","Places",function(a,b,c,d,e,g,h){a.submitting=!1;a.autocompleting=0;a.lastQuery;a.selected;a.clickBody=function(){g.find("body").triggerHandler("click")};a.blurInput=function(){g.find("input").trigger("blur")};a.getPlaces=function(b){a.lastQuery=b;var c=e.defer();a.autocompleting++;h.getPlacePredictions(b,function(b){a.$apply(function(){a.autocompleting--;c.resolve(b)})},
function(){a.$apply(function(){a.autocompleting--;c.resolve([])})});return c.promise};var f=function(b){a.submitting=!1;d.error(b);a.addAlert("error","There was an error retrieving search results. TODO: better messages")};a.$watch("selected",function(b){b&&b.constructor===Object&&a.submit(b)});a.search=function(b){b&&b.constructor===Object?a.submit(b):b&&a.getPlaces(b).then(function(b){0<b.length&&a.submit(b[0])})};a.submit=function(d){d&&d.reference&&(a.submitting=!0,a.autocompleting=0,h.getDetails(d.reference,
function(d){a.$apply(function(){a.submitting=!1;c.reload();b.path("/map/").search({}).search("m_zoom",8);d.geometry.location&&(b.search("m_center",d.geometry.location.toUrlValue()),b.search("m_selected",d.geometry.location.toUrlValue()));d.geometry.viewport&&b.search("m_bounds",d.geometry.viewport.toUrlValue())});a.blurInput()},f))}}])})();(function(){angular.module("hutmap.controllers").controller("HutInfoCtrl",["$scope",function(a){a.accuracy_text="Unverified;Wild guess;Guess;Found on satellite or topo;Surveyed by GPS;Surveyed by GPS and found on satellite or topo".split(";");a.mouseoverHut=function(b){a.setHutMarkerEvents([{event:"mouseover",locations:[new google.maps.LatLng(b.location.coordinates[1],b.location.coordinates[0])]}])};a.mouseoutHut=function(b){a.setHutMarkerEvents([{event:"mouseout",locations:[new google.maps.LatLng(b.location.coordinates[1],
b.location.coordinates[0])]}])};a.clickHut=function(b){a.setHutMarkerEvents([{event:"click",locations:[new google.maps.LatLng(b.location.coordinates[1],b.location.coordinates[0])]}])}}])})();(function(){angular.module("hutmap.controllers").controller("AlertCtrl",["$scope",function(a){a.alerts=[];a.addAlert=function(b,c){a.alerts.push({type:b,msg:c})};a.closeAlert=function(b){a.alerts.splice(b,1)}}])})();(function(){angular.module("hutmap.controllers").controller("FilterCtrl",["$scope","$timeout",function(a,b){function c(){var b=[],c=[],g,h=[];angular.forEach(a.shelterType,function(a){a.include&&(h=h.concat(a.keywords))});g=h;angular.forEach(a.huts,function(f){var j;j=a.season;if(j=j.summer&&f.open_summer||j.winter&&f.open_winter||j.unknown&&!f.open_summer&&!f.open_winter){var h=!1;a.anyShelterType?h=!0:angular.forEach(g,function(a){~f.types.indexOf(a)&&(h=!0)});j=h}j&&(b.push(f),c[f.id]=f.id)});
a.setFilteredHuts(b,c);a.$broadcast("gmMarkersRedraw","huts")}a.resetFilters=function(){a.season={winter:!0,summer:!0,unknown:!0};a.anyShelterType=!0;a.shelterType={"emergency shelters":{include:!1,keywords:["Emergency Shelter","Refuge"]},"fire lookouts":{include:!1,keywords:["Fire Lookout"]},"huts & yurts":{include:!1,keywords:"Hut;Yurt;Chickee;Lean-to;Wall Tent;Shelter".split(";")},compounds:{include:!1,keywords:"Compound;Hostel;Tea House;Lodge;Chalet;Ranch;Farm".split(";")}};a.filter()};a.setAnyShelterType=
function(b){a.anyShelterType=b};a.$watch("anyShelterType",function(b){b&&angular.forEach(a.shelterType,function(a){a.include=!1})});a.filter=function(){a.incLoading();b(c).then(function(){a.decLoading()})};a.$watch("huts",function(){a.filter()});a.resetFilters()}])})();(function(){angular.module("hutmap.controllers").controller("MapConfigCtrl",["$scope","$http","hutmapMapId","angulargmContainer","mapOptions","markerOptions",function(a,b,c,d,e,g){b=d.getMapPromise(c);var h,f;a.hutmapMapId=c;a.mapOptions=e;a.markerOptions=g;a.getMarkerOptions=function(b){var c={};return a.filteredHuts&&b.id in a.filteredHutIds?angular.extend(c,a.markerOptions.filteredHuts):angular.extend(c,a.markerOptions.huts)};a.selectHut=function(b,c){if(h){var d=angular.extend({},g.huts,{icon:f});
h.setOptions(d)}h=b;f=b.getIcon();b.setOptions(g.selected);a.setSelectedHut(c)};b.then(function(a){var b={MSR_TOPO:new google.maps.ImageMapType({name:"MSR USGS",alt:"USGS topos from Microsoft Research",minZoom:1,maxZoom:15,tileSize:new google.maps.Size(256,256),isPng:!1,getTileUrl:function(b,c){var d=a.getProjection(),e=Math.pow(2,c),f=new google.maps.Point(256*b.x/e,256*(b.y+1)/e),e=new google.maps.Point(256*(b.x+1)/e,256*b.y/e),f=d.fromPointToLatLng(f),d=d.fromPointToLatLng(e);return"http://msrmaps.com/ogcmap.ashx?version=1.1.1&request=GetMap&Layers=drg&Styles=default&SRS=EPSG:4326&BBOX="+
[f.lng(),f.lat(),d.lng(),d.lat()].join()+"&width=256&height=256&format=image/jpeg"}}),ARC_GIS_USA:new google.maps.ImageMapType({name:"ArcGIS USA",alt:"ArcGIS USA Topos",minZoom:1,maxZoom:15,tileSize:new google.maps.Size(256,256),isPng:!0,getTileUrl:function(a,b){var c=1<<b,d=a.x%c;0>d&&(d+=c);return"http://services.arcgisonline.com/ArcGIS/rest/services/USA_Topo_Maps/MapServer/tile/"+parseInt(b)+"/"+a.y+"/"+d}}),ARC_GIS_WORLD:new google.maps.ImageMapType({name:"ArcGIS World",alt:"ArcGIS World Topos",
minZoom:1,maxZoom:15,tileSize:new google.maps.Size(256,256),isPng:!0,getTileUrl:function(a,b){var c=1<<b,d=a.x%c;0>d&&(d+=c);return"http://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/"+parseInt(b)+"/"+a.y+"/"+d}})};angular.forEach(b,function(b){a.mapTypes.set(b.name,b)});a.setOptions({mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.SATELLITE,google.maps.MapTypeId.HYBRID,google.maps.MapTypeId.TERRAIN,b.MSR_TOPO.name,b.ARC_GIS_USA.name,
b.ARC_GIS_WORLD.name]}});a.enableKeyDragZoom({key:"alt",visualEnabled:!0})})}])})();(function(){angular.module("hutmap.controllers").controller("HutmapCtrl",["$scope","$route",function(a,b){a.$route=b;a.range=function(){var a,b,e,g=[];switch(arguments.length){case 0:throw Error("range() expected at least 1 argument, got 0 - must be specified as [start,] stop[, step]");case 1:a=0;b=Math.floor(arguments[0])-1;e=1;break;default:if(a=Math.floor(arguments[0]),b=Math.floor(arguments[1])-1,e=arguments[2],"undefined"===typeof e&&(e=1),!(e=Math.floor(e)))throw Error("range() step argument must not be zero");
}if(0<e)for(;a<=b;a+=e)g.push(a);else if(0>e&&(e=-e,a>b))for(;a>b+1;a-=e)g.push(a);return g}}])})();(function(){angular.module("hutmap.controllers").controller("MapCtrl",["$scope","$location","$timeout","$q","utils","MarkerTooltip",function(a,b,c,d,e,g){var h=d.defer(),f=d.defer(),j={};a.center;a.zoom;a.bounds;a.hutMarkerEvents;var m=function(){f.promise.then(function(){a.setSelectedHut(null);var c=b.search().m_selected;null!=c&&(a.hutMarkerEvents=[{event:"click",locations:[e.latLngFromUrlValue(c)]}])})};c=function(c,d){if(c!==d&&(a.center&&b.search("m_center",a.center.toUrlValue()),a.zoom&&b.search("m_zoom",
a.zoom),a.selectedHut)){var e=a.selectedHut.location;b.search("m_selected",e.coordinates[1]+","+e.coordinates[0])}};a.$watch("center != null && zoom != null",function(a){a&&h.resolve()});a.$watch("huts != null",function(a){a&&f.resolve()});a.$watch("center",c);a.$watch("zoom",c);a.$watch("selectedHut",c);a.$watch("bounds",function(b){b&&a.loadNewHuts&&a.setQuery({bounds:b})});a.$on("gmMarkersUpdated",function(a,b){"huts"===b&&m()});a.setHutMarkerEvents=function(b){a.hutMarkerEvents=b};a.showMarkerTooltip=
function(a,b){var c=j[a.getPosition().toUrlValue()];c?c.show():(c=new g({marker:a,content:b.name}),j[a.getPosition().toUrlValue()]=c)};a.hideMarkerTooltip=function(){angular.forEach(j,function(a){a.hide()})};var k=b.search().m_center,q=b.search().m_zoom,n=b.search().m_bounds;b.search("m_center",null);b.search("m_zoom",null);b.search("m_bounds",null);h.promise.then(function(){var b=null!=n;!b&&null!=k&&(a.center=e.latLngFromUrlValue(k));!b&&null!=q&&(a.zoom=Number(q));b&&(a.bounds=e.boundsFromUrlValue(n))});
m()}])})();(function(){angular.module("hutmap.services",[])})();(function(){angular.module("hutmap.services").factory("utils",[function(){return{latLngFromUrlValue:function(a){a=a.split(",");return new google.maps.LatLng(a[0],a[1])},latLngFromHut:function(a){return new google.maps.LatLng(a.location.coordinates[1],a.location.coordinates[0])},boundsFromUrlValue:function(a){a=a.split(",");return new google.maps.LatLngBounds(new google.maps.LatLng(a[0],a[1]),new google.maps.LatLng(a[2],a[3]))}}}])})();(function(){angular.module("hutmap.services").provider("Places",[function(){var a={},b=new google.maps.LatLngBounds(new google.maps.LatLng(-90,180),new google.maps.LatLng(90,-180));a.bounds=function(a){b=a};a.$get=function(){function a(b,c,d,e){e==google.maps.places.PlacesServiceStatus.OK?b(d):c(e)}var d={},e=angular.element('<div id="google-attributions"></div>'),g=new google.maps.places.PlacesService(e[0]),h=new google.maps.places.AutocompleteService;d.getPlacePredictions=function(d,e,g){h.getPlacePredictions({input:d,
bounds:b},angular.bind(this,a,e,g))};d.getDetails=function(b,d,e){g.getDetails({reference:b},angular.bind(this,a,d,e))};d.textSearch=function(b,d,e){g.textSearch(b,angular.bind(this,a,d,e))};return d};return a}])})();(function(){angular.module("hutmap.services").factory("Huts",["$http","$q","utils",function(a,b,c){function d(a){if(null==a)throw"id should not be null";a.constructor===String&&-1<a.indexOf("/")&&(a=a.slice(0,-1),a=a.slice(a.lastIndexOf("/")+1));return Number(a)}var e={},g,h=b.defer();a.get("/static/data/huts.json").success(function(a){null!=a?(g=a,h.resolve()):h.reject("/static/data/huts.json response was null")}).error(function(a){h.reject(a)});e.query=function(a){return h.promise.then(function(){var b=
a||{},d=b.bounds,e=b.limit||0,h=[];angular.forEach(g.huts.object_index,function(a){var b;if(b=0===e||h.length<e)d?(b=c.latLngFromHut(a),b=d.contains(b)):b=!0;b&&h.push(a)});return h})};e.totalHutCount=function(){return h.promise.then(function(){return g.huts.meta.total_count})};e.hut=function(a){return h.promise.then(function(){var b=d(a);return g.huts.object_index[b]})};e.agency=function(a){return h.promise.then(function(){var b=d(a);return g.agencies.object_index[b]})};e.region=function(a){return h.promise.then(function(){var b=
d(a);return g.regions.object_index[b]})};return e}])})();(function(){angular.module("hutmap.services").factory("MarkerTooltip",[function(){function a(a){this.marker_=a.marker;this.content_=a.content;this.map_=a.marker.get("map");this.div_=null;this.setMap(this.map_)}a.prototype=new google.maps.OverlayView;a.prototype.onAdd=function(){var a=document.createElement("DIV"),c=document.createElement("DIV");a.appendChild(c);a.style.position="absolute";a.className+=" tooltip fade in";c.className+=" tooltip-inner";c.innerHTML=this.content_;this.div_=a;this.getPanes().floatPane.appendChild(this.div_)};
a.prototype.draw=function(){var a=this.getProjection().fromLatLngToDivPixel(this.marker_.getPosition()),c=this.div_;c.style.left=a.x+"px";c.style.top=a.y+"px"};a.prototype.onRemove=function(){this.div_.parentNode.removeChild(this.div_)};a.prototype.hide=function(){this.div_&&(this.div_.style.visibility="hidden")};a.prototype.show=function(){this.div_&&(this.div_.style.visibility="visible")};return a}])})();
